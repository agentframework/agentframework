Agent Framework for TypeScript 2.2+
-----------------------------------

[![Build Status](https://travis-ci.org/agentframework/agentframework.svg?branch=master)](https://travis-ci.org/agentframework/agentframework)
[![Coverage Status](https://coveralls.io/repos/github/agentframework/agentframework/badge.svg?branch=master)](https://coveralls.io/github/agentframework/agentframework?branch=master)

### What's this?

- AOP for TypeScript
- Elegant design pattern to decorate your class with metadata and interceptors 
- 100% TypeScript implementation! No dependencies!!!
- Require ES6 and TypeScript 2.2+
- Work in both node and browser

### Why use Agent Framework?

- You need a powerful method to pre-process, post-process or modify system behaviors without touching existing code.
- You want to build an abstract layer for a specific business domain in your organization.
- You want to remove duplicated code and keep project codebase small and clean.

### When use Agent Framework?

Agent Framework will help you on following areas: (which I did in other projects)

- Dependency Injection
- Data Access Layer
- Application Framework
- Service Hosting and Communication
- Validation
- Tracking / Monitoring
- Utilities
- ...
- **And there's a new octoverse out there that is waiting to be explored**


### Install and usage

```bash
  npm install --save agentframework
```
or
```bash
  yarn add agentframework
```

### Show me the code

Just add 3 lines to your existing source code to enable the powerful Dependence Injection.

- `import { agent, inject } from 'agentframework'`
- `@agent()`
- `@inject(Project)`

```typescript
import { agent, inject } from 'agentframework'

class Project {
  name = 'Agent Framework';
}

@agent()
class Developer {

  @inject(Project)
  project;
  
  constructor() {
    // EPIC: access the injected variable inside constructor
    console.log(`WOW! You working on project ${this.project.name}!`);
  }
  
}

// EPIC: create interceptable agent as easy as construct a new class
const you = new Developer();
console.log('Is it create from the Developer class?', you instanceof Developer);

// Results:
// > WOW! You working on project Agent Framework!
// > Is it create from the Developer class? true

```

**Examples**

- [@prerequisite()](https://github.com/agentframework/agentframework/blob/master/src/lib/extra/prerequisite.spec.ts) Do not run the method body and `throw` an error when `prerequistite()` not met

- [@conditional()](https://github.com/agentframework/agentframework/blob/master/src/lib/extra/conditional.spec.ts) Likes `prerequistite()` but not throw error

- [@normalize()](https://github.com/agentframework/agentframework/blob/master/src/lib/extra/normalize.spec.ts) Capture `throw` in the method and modify the return value to this object `{ ok: 1|0, result?: any = return object, results?: any = return array, message?: string = err.message }` 

- [@success()](https://github.com/agentframework/agentframework/blob/master/src/lib/extra/success.spec.ts) Change the specified class property value when this method run success (without `throw`)

- [@failure()](https://github.com/agentframework/agentframework/blob/master/src/lib/extra/failure.spec.ts)  Always return specified value if any `throw` happen in the intercepted method.

- [@timestamp()](https://github.com/agentframework/agentframework/blob/master/src/lib/extra/timestamp.spec.ts)  Update timestamp field after changes the field value

- [@cache()](https://github.com/agentframework/agentframework/blob/master/src/lib/extra/cache.spec.ts)  Simple but useful memory cache implementation

- [@inject()](https://github.com/agentframework/agentframework/blob/master/src/lib/extra/inject.spec.ts)  Dependence injection

- [@timestamp()](https://github.com/agentframework/agentframework/blob/master/src/lib/extra/timestamp.spec.ts)  Update timestamp field after changes the field value

- [@cache()](https://github.com/agentframework/agentframework/blob/master/src/lib/extra/cache.spec.ts)  Simple but useful memory cache implementation

**Advanced Examples (will be available after release 1.0)**
- Calculate the execution time of methods
- Check user group before the operations
- Add log for request and response
- Catch all error and normalize a response
- Create Singleton instance
- Create a ORM library
- Prevent Mongodb injection
- Create a scheduler


### Road to v1.0

- [x] MVP: Reflection can access type information generated by tsc. `tsc --emitDecoratorMetadata`
- [x] MVP: Reflection support both ES6 and ES2017 (Reflect.metadata)
- [x] MVP: Share metadata across different agentframework library of same application
- [x] MVP: Both agent or normal class can be used for dependence injection
- [x] MVP: Add IInitializer to init a field property
- [x] MVP: Interceptor can work with Initializer during dependence injection
- [x] EPIC: Create agent without domain
- [x] EPIC: Provide access to intercepted property value in constructor
- [x] PERFORMANCE: Metadata only attribute, attribute without interceptor
- [x] PERFORMANCE: Pre-compile class member interceptors to improve method call performance
- [x] PERFORMANCE: Cache class constructor interceptors to faster initialize new class instance staring from second time.
- [x] PERFORMANCE: Remove interceptor for @agent attribute to improve performance
- [x] PERFORMANCE: Do not add proxy if the agent don't have interceptor
- [x] PERFORMANCE: Remove ES6 Proxy if don't have field interceptor
- [x] COMPATIBILITY: Move @inject and @ready decorator out from core
- [x] COMPATIBILITY: GetPrototypeOf should return origin prototype
- [x] COMPATIBILITY: Agent should works in extended classes
- [ ] COMPATIBILITY: Revise IInvocation Interface
- [ ] COMPATIBILITY: Revise IInitializer Interface
- [ ] COMPATIBILITY: Revise IInterceptor Interface
- [ ] COMPATIBILITY: Revise IAttribute Interface
- [ ] COMPATIBILITY: Revise Agent Options
- [ ] COMPATIBILITY: Revise Domain Interface
- [ ] COMPATIBILITY: Revise Reflection Interface


### Concepts in Agent Framework

- Attribute (associating declarative information with TypeScript code, e.g classes, methods and fields)
- Reflection (access the associated declarative information from classes, method or fields)
- Agent (A class which decorated with attributes)
- Domain (A host environment for agents)


### The Future of Agent Framework

The goal of Agent Framework is to build the first AaaS cloud which implement [Agent Oriented Programming](https://en.wikipedia.org/wiki/Agent-oriented_programming).

It's different to any of the clouds today, the major different are:

- AaaS is a distributed cloud network which doesn't have a central database. 
- IPv6 is mandatory for an agent live in AaaS cloud.
- Agent will use cryptocurrency to collaborate with other agent or pay the rent to the hosting domain.
- The host(a domain) which have power, storage and it providing computing resource to host agents.

